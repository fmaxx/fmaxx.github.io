---
layout:     post
title:      Provisioning ios часть-2.
date:       2017-06-06 11:21:29
summary:    Управление профилями и сертификатами.
categories: ios provisioning
---

Перевод статьи [DEMYSTIFYING IOS PROVISIONING PART 2: CREATING AND ASSIGNING CERTIFICATES AND PROFILES](http://martiancraft.com/blog/2017/07/demystifying-provisioning-part2/)

[Перевод первой части здесь]({% post_url 2017-08-20-ios-provisioning-part-1 %})

Разрушая мифы iOS Provisioning, часть 2: управление сертификатами и профилями.
==================

В [первой части]({% post_url 2017-08-20-ios-provisioning-part-1 %}) этой статьи мы узнали что такое сертификаты и профили, как они используются в разработке под платформу Apple. Во второй части статьи мы обсудим как создать все нужное для подписи приложения в личном кабинете разработчика на сайте Apple и как это подключить в Xcode.

Наши задачи:

* создать App ID
* сгенерировать *development* and *App Store* сертификаты
* создать *development* и *distribution* provisioning профили
* создать схему (назовем ее *App Store*) в Xcode проекте
* настроить сертификаты и профили в схеме

Многие задачи выполняются в разделе Provisioning в личном кабинете разработчика на сайте [Apple Developer](http://developer.apple.com).
![Provisioning](/images/2017-08-15-ios-provisioning-part-2/1.png)

Если у вас уже есть оплаченный аккаунт, откройте [Apple Developer website](http://developer.apple.com), выберете "Account" -> "Certificates, Identifiers & Profiles."

## Создание App IDs
App ID это уникальный идентификатор для регистрации вашего приложения. Первым делом, давайте создадим его.
![App IDs](/images/2017-08-15-ios-provisioning-part-2/2.png)

Шаги для регистрации на сайте apple разрабочика:
1. Выберите "App IDs" под вкладкой "Identifiers" 
2. Нажмите “+” вверху списка
3. Введите имя для App ID (используйте название приложения или название + дополнительное имя)
4. Выберите “Explicit App ID” и введите ваш Bundle ID в текстовое поле
5. Под “App Services” раздела, выберите сервисы нужные для вашего приложения (их можно будет отредактировать позже)
6. Нажимаем “Continue”
7. Если все хорошо - выбираем “Register”

Это все. Bundle ID зарегистрирован и можно генерировать профили на основе этого ID. Если в будущем вы измените Bundle ID, придется также удалить App ID (если он не будет использоваться) и пересоздать новый App ID.

Так, а в чем тогда разница между App ID и Bundle ID? В общем App ID это уникальный идентификатор приложения в экосистеме App Store, не может быть двух приложений там с одинаковыми App ID. Bunlde ID это идентификатор учетной записи разработчика (используется обратная доменная запись - com.mysite.appname).

## Создание сертификатов
Я расскажу вам как создавать сертификат для App Store (другие сертификаты созадаются аналогично). Сертификат можно использовать для разработки и распространения всех ваших приложений.

Первое - нужно создать *Certificate Signing Request (CSR)* в личном кабинете разработчика, для этого:

1. на вашем Mac откройте *Keychain Access* (находится тут - /Applications/Utilities).
2. далее в Keychain Access > Certificate Assistant > Request a Certificate From a Certificate Authority.
3. в окне введите ваш email и имя, затем выберите "Save to disk" в опции "Request is".
4. жмите Contunue и сохраните файл на компьютере Mac.
![Certificate Signing Request](/images/2017-08-15-ios-provisioning-part-2/3.png)

Теперь у на есть CSR, и мы готовы сгенерировать рабочий сертификат, для этого заходим в личный кабинет и:
1. идем в раздел Certificates, Identifiers & Profiles > Certificates > All
2. нажимаем "+" чтобы создать новый сертификат
3. выбираем “iOS App Development” для создания development сертификата для отладки на зарегистрированных устройствах
4. Continue
5. дальше будут инструкции как сгенерировать CSR (мы уже это сделали!)
6. загрузите запрос CSR (инструкции прилагаются)
7. жмем на Download для загрузки сгенерированного сертификата, после этого двойным кликом мышки добавляем его в Keychain Access
![certificate](/images/2017-08-15-ios-provisioning-part-2/4.png) 

Для проверки что сертификат установлен в системе, зайдите в Keychain Access > Login Keychain > Certificate, вы должны увидеть публичный и приватные ключи с префиксом "iPhone Developer" (это значит что сертификат для подписки ios приложений, у сертификатов для Mac приложений будет - "Mac development").

"App Store and Ad Hoc" сертификаты создаются аналогично (разница в п.3 только), сертификат действителен один год, по окончании срока его нужно удалить и создать новый, при этом все связанные provisioning профили аннулируются и их также придется повторно сгенерировать.

## Регистрация устройств
Тестовые устройства для отладки приложений регистрируются в помощью UDID - уникального идентификатора. Он включается в provisioning профили (создадим на следующем шаге), при добавлении/удалении нового устройства нужно повторно сгенерировать provisioning профиль. Поэтому мы сделаем этот шаг первым.

UDID устройства можно найти в iTunes или в Xcode (подключите устройство к Mac запустите Xcode, найдите в  Window > Devices > ваше устройство и скопируйте UDID строку в разделе "Identifier"), это уникальный идентификатор вашего физического устройства.

Для регистрации UDID:
1. идем в Certificates, Identifiers & Profiles > Devices > All (личный кабинет разработчика)
2. жмем "+" для добавления нового устройства
3. вводим имя, мы рекомендуем формат для этого "Имя/Тип устройства/Добавлен или Изменен/Дата", удобно для больший команд
4. вводим UDID
5. нажимаем "Contunue"
![UDID](/images/2017-08-15-ios-provisioning-part-2/5.png) 

Теперь устройство зарегистрировано в вашей учетной записи, однако устройства могут быть зарегистрированы у нескольких разработчиках. После регистрации устройство можно включать в provisioning профиль для запуска приложения на нем.

## Создание профилей
Provisionig профиль ключевой момент подписи приложения. Он определяет какие устройства имеют право запускать подписанное приложение, указывает на сертификат для подписи приложения, а также какие сервисы будут доступны для приложения на этом устройстве (iCloud, APNs и т.д).

Создать provision профиль довольно просто в личном кабинете разработчика, для этого:





